<div class="card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Lọc</h5>
        <button class="btn btn-link" onclick="clearFilters()">Xóa lọc</button>
    </div>
    <div class="card-body">
        <form id="filterForm" asp-controller="Train" asp-action="SearchTrain" method="get" style="width:auto">
            <div class="filter-group">
                <div class="filter-title">
                    <p>Giờ đi</p>
                </div>
                <div class="input-group">
                    <input type="text" class="form-control" name="startTime" value="00:00" style="height:max-content;text-align: center;">
                    <span class="input-group-text">đến</span>
                    <input type="text" class="form-control" name="endTime" value="24:00" style="height:max-content;text-align: center;">
                </div>
            </div>

            <div class="filter-group mt-3">
                <div class="filter-title">
                    <p>Nơi đi</p>
                </div>
                <select class="form-select" id="startRoute" name="startRoute" onchange="submitFilterForm()">
                    <option value="" selected>Mặc Định</option>
                    @foreach (var route in Model.TrainRoutes)
                    {
                        <option value="@route.PointStart">@route.PointStart</option>
                    }
                </select>
            </div>

            <div class="filter-group mt-3">
                <div class="filter-title">
                    <p>Nơi đến</p>
                </div>
                <select class="form-select" id="endRoute" name="endRoute" onchange="submitFilterForm()">
                    <option value="" selected>Mặc Định</option>
                    @foreach (var route in Model.TrainRoutes)
                    {
                        <option value="@route.PointEnd">@route.PointEnd</option>
                    }
                </select>
            </div>

            <div class="filter-group mt-3">
                <div class="filter-title">
                    <p>Loại xe</p>
                </div>
                <select class="form-select" id="vehicleType" name="vehicleType" onchange="submitFilterForm()">
                    <option value="" selected>Mặc Định</option>
                    @* @foreach (var vehicleType in Model.VehicleTypes)
                    {
                    <option value="@vehicleType.Id">@vehicleType.Name</option>
                    } *@
                </select>
            </div>
        </form>
    </div>
</div>

<style>
    .filter-title p {
        margin-bottom: 0px;
    }

    .form-select {
        color: gray;
    }

        .form-select option {
            color: black;
        }
</style>

<script>
    function submitFilterForm() {
        const startRoute = document.getElementById('startRoute').value;
        const endRoute = document.getElementById('endRoute').value;

        // Tạo chuỗi truy vấn URL với các bộ lọc đã chọn
        let queryString = "";
        if (startRoute) {
            queryString += `noiDi=${startRoute}`;
        }
        if (endRoute) {
            queryString += (queryString.length > 0 ? '&' : '') + `noiDen=${endRoute}`;
        }

        // Gửi yêu cầu GET đến TrainController với các tham số truy vấn
        fetch(`/Train/SearchTrain?${queryString}`, {
            method: 'GET'
        }).then(response => {
            // Xử lý kết quả nếu cần
            console.log('Redirecting to:', response.url);
            window.location.href = response.url; // Chuyển hướng đến URL được phản hồi từ server
        }).catch(error => {
            console.error('Error:', error);
        });
    }

    function clearFilters() {
        document.getElementById('startRoute').value = '';
        document.getElementById('endRoute').value = '';
        document.getElementById('vehicleType').value = '';
        document.getElementById('filterForm').submit();
    }
</script>
